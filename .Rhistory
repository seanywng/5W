group_by(organizacion_implementadora) %>%
summarise(male = sum((beneficiarios[sex_ben == "male"])),
female = sum((beneficiarios[sex_ben == "female"])),
sex_ratio = round((male/female), digits = 2),
beneficiarios = sum(beneficiarios, na.rm = TRUE)) %>%
mutate(percent_of_total = round((beneficiarios / sum(beneficiarios) * 100), digits = 2)) %>%
left_join(mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
group_by(organizacion_implementadora) %>%
summarise(num_municipalities = n_distinct(pcode2))) %>%
relocate(beneficiarios, .after = organizacion_implementadora) %>%
relocate(percent_of_total, .after = beneficiarios) %>%
arrange(desc(beneficiarios)) %>%
pander(big.mark = ",", style = "rmarkdown")
act_ben2 %>%
mutate(sex_ben = ifelse(str_detect(desagregacion, "^m"), "male",
ifelse(str_detect(desagregacion, "^f"), "female", "no_esp"))) %>%
mutate(actividad = actividad_desc) %>%
group_by(organizacion_implementadora) %>%
summarise(male = sum((beneficiarios[sex_ben == "male"])),
female = sum((beneficiarios[sex_ben == "female"])),
sex_ratio = round((male/female), digits = 2),
beneficiarios = sum(beneficiarios, na.rm = TRUE)) %>%
mutate(percent_of_total = round((beneficiarios / sum(beneficiarios) * 100), digits = 2)) %>%
left_join(act_ben %>%
mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
group_by(organizacion_implementadora) %>%
summarise(num_municipalities = n_distinct(pcode2))) %>%
relocate(beneficiarios, .after = organizacion_implementadora) %>%
relocate(percent_of_total, .after = beneficiarios) %>%
arrange(desc(beneficiarios)) %>%
pander(big.mark = ",", style = "rmarkdown")
act_ben2 %>%
mutate(sex_ben = ifelse(str_detect(desagregacion, "^m"), "male",
ifelse(str_detect(desagregacion, "^f"), "female", "no_esp"))) %>%
mutate(actividad = actividad_desc) %>%
group_by(organizacion_implementadora) %>%
summarise(male = sum((beneficiarios[sex_ben == "male"])),
female = sum((beneficiarios[sex_ben == "female"])),
sex_ratio = round((male/female), digits = 2),
beneficiarios = sum(beneficiarios, na.rm = TRUE)) %>%
mutate(percent_of_total = round((beneficiarios / sum(beneficiarios) * 100), digits = 2)) %>%
left_join(act_ben %>%
mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
group_by(organizacion_implementadora) %>%
summarise(municipalities = n_distinct(pcode2))) %>%
relocate(beneficiarios, .after = organizacion_implementadora) %>%
relocate(percent_of_total, .after = beneficiarios) %>%
arrange(desc(beneficiarios)) %>%
pander(big.mark = ",", style = "rmarkdown")
act_ben2 %>%
mutate(sex_ben = ifelse(str_detect(desagregacion, "^m"), "male",
ifelse(str_detect(desagregacion, "^f"), "female", "no_esp"))) %>%
mutate(actividad = actividad_desc) %>%
group_by(organizacion_implementadora) %>%
summarise(male = sum((beneficiarios[sex_ben == "male"])),
female = sum((beneficiarios[sex_ben == "female"])),
sex_ratio = round((male/female), digits = 2),
beneficiarios = sum(beneficiarios, na.rm = TRUE)) %>%
mutate(percent_of_total = round((beneficiarios / sum(beneficiarios) * 100), digits = 2)) %>%
left_join(act_ben %>%
mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
group_by(organizacion_implementadora) %>%
summarise(municipalities = n_distinct(pcode2))) %>%
relocate(beneficiarios, .after = organizacion_implementadora) %>%
relocate(percent_of_total, .after = beneficiarios) %>%
arrange(desc(beneficiarios)) %>%
pander(big.mark = ",", style = "rmarkdown")
act_ben2 %>%
mutate(sex_ben = ifelse(str_detect(desagregacion, "^m"), "male",
ifelse(str_detect(desagregacion, "^f"), "female", "no_esp"))) %>%
mutate(actividad = actividad_desc) %>%
group_by(organizacion_implementadora) %>%
summarise(male = sum((beneficiarios[sex_ben == "male"])),
female = sum((beneficiarios[sex_ben == "female"])),
sex_ratio = round((male/female), digits = 2),
beneficiarios = sum(beneficiarios, na.rm = TRUE)) %>%
mutate(percent_of_total = round((beneficiarios / sum(beneficiarios) * 100), digits = 2)) %>%
left_join(act_ben %>%
mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
group_by(organizacion_implementadora) %>%
summarise(municipalities = n_distinct(pcode2)),
by = "organizacion_implementadora") %>%
relocate(beneficiarios, .after = organizacion_implementadora) %>%
relocate(percent_of_total, .after = beneficiarios) %>%
arrange(desc(beneficiarios)) %>%
pander(big.mark = ",", style = "rmarkdown")
act_lines <- act_ben2 %>%
mutate(mes_solo = as.Date(mes_solo)) %>%
group_by(actividad_short, mes_solo) %>%
summarise(cumulative = sum(beneficiarios)) %>%
mutate(cumulative = round(cumsum(cumulative))) %>%
ggplot(aes(x = mes_solo, y = cumulative, colour = actividad_short)) +
geom_line() +
geom_point(size = 0.7) +
scale_x_date(date_labels = "%b-%Y", date_breaks = "1 month") +
scale_y_continuous(labels = unit_format(unit = "K", scale = 1e-3, sep = ""),
trans = "log10",
limits = c(0, 500000)) +
xlab("") + ylab("Beneficiarios") +
scale_colour_discrete(name = "Actividad") +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "bottom",
legend.text = element_text(size = 6)) +
guides(fill = guide_legend(nrow = 2, byrow = TRUE))
ggplotly(act_lines, tooltip = c("x", "y", "colour")) %>%
config(displayModeBar = FALSE) %>%
layout(showlegend = TRUE, legend = list(font = list(size = 6)))
act_lines <- act_ben2 %>%
mutate(mes_solo = as.Date(mes_solo)) %>%
group_by(actividad_short, mes_solo) %>%
summarise(cumulative = sum(beneficiarios)) %>%
mutate(cumulative = round(cumsum(cumulative))) %>%
ggplot(aes(x = mes_solo, y = cumulative, colour = actividad_short)) +
geom_line() +
geom_point(size = 0.7) +
scale_x_date(date_labels = "%b-%Y", date_breaks = "1 month") +
scale_y_continuous(labels = unit_format(unit = "K", scale = 1e-3, sep = ""),
trans = "log10") +
xlab("") + ylab("Beneficiarios") +
scale_colour_discrete(name = "Actividad") +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "bottom",
legend.text = element_text(size = 6)) +
guides(fill = guide_legend(nrow = 2, byrow = TRUE))
ggplotly(act_lines, tooltip = c("x", "y", "colour")) %>%
config(displayModeBar = FALSE) %>%
layout(showlegend = TRUE, legend = list(font = list(size = 6)))
act_lines <- act_ben2 %>%
mutate(mes_solo = as.Date(mes_solo)) %>%
group_by(actividad_short, mes_solo) %>%
summarise(cumulative = sum(beneficiarios)) %>%
mutate(cumulative = round(cumsum(cumulative))) %>%
ggplot(aes(x = mes_solo, y = cumulative, colour = actividad_short)) +
geom_line() +
geom_point(size = 0.7) +
scale_x_date(date_labels = "%b-%Y", date_breaks = "1 month") +
scale_y_continuous(labels = unit_format(unit = "K", scale = 1e-3, sep = ""),
trans = "log2") +
xlab("") + ylab("Beneficiarios") +
scale_colour_discrete(name = "Actividad") +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "bottom",
legend.text = element_text(size = 6)) +
guides(fill = guide_legend(nrow = 2, byrow = TRUE))
ggplotly(act_lines, tooltip = c("x", "y", "colour")) %>%
config(displayModeBar = FALSE) %>%
layout(showlegend = TRUE, legend = list(font = list(size = 6)))
act_lines <- act_ben2 %>%
mutate(mes_solo = as.Date(mes_solo)) %>%
group_by(actividad_short, mes_solo) %>%
summarise(cumulative = sum(beneficiarios)) %>%
mutate(cumulative = round(cumsum(cumulative))) %>%
ggplot(aes(x = mes_solo, y = cumulative, colour = actividad_short)) +
geom_line() +
geom_point(size = 0.7) +
scale_x_date(date_labels = "%b-%Y", date_breaks = "1 month") +
scale_y_continuous(labels = unit_format(unit = "K", scale = 1e-3, sep = ""),
limits = c(0, 500000)) +
xlab("") + ylab("Beneficiarios") +
scale_colour_discrete(name = "Actividad") +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "bottom",
legend.text = element_text(size = 6)) +
guides(fill = guide_legend(nrow = 2, byrow = TRUE))
ggplotly(act_lines, tooltip = c("x", "y", "colour")) %>%
config(displayModeBar = FALSE) %>%
layout(showlegend = TRUE, legend = list(font = list(size = 6)))
act_lines <- act_ben2 %>%
mutate(mes_solo = as.Date(mes_solo)) %>%
group_by(actividad_short, mes_solo) %>%
summarise(cumulative = sum(beneficiarios)) %>%
mutate(cumulative = round(cumsum(cumulative))) %>%
ggplot(aes(x = mes_solo, y = cumulative, colour = actividad_short)) +
geom_line() +
geom_point(size = 0.7) +
scale_x_date(date_labels = "%b-%Y", date_breaks = "1 month") +
scale_y_continuous(labels = unit_format(unit = "K", scale = 1e-3, sep = ""),
limits = c(0, 500000)) +
xlab("") + ylab("Beneficiarios") +
scale_colour_discrete(name = "Actividad") +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "bottom",
legend.text = element_text(size = 6)) +
guides(fill = guide_legend(nrow = 2, byrow = TRUE))
ggplotly(act_lines, tooltip = c("x", "y", "colour")) %>%
layout(showlegend = TRUE, legend = list(font = list(size = 6)))
500*21*11.5
530*21*11.5
525*21*11.5
530*155
550*155
inytex::install_tinytex()
tinytex::install_tinytex()
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
fig.width = 10)
library(tidyverse)
library(lubridate)
library(stringr)
library(pander)
library(scales)
library(forcats)
library(janitor)
library(readxl)
library(ggmap)
library(sf)
library(patchwork)
library(maptools)
library(ggforce)
library(ggthemes)
library(plotly)
library(kableExtra)
library(DT)
library(tinytex)
library(webshot)
# pander thousands separator
panderOptions("big.mark", ",")
# MAKE SURE YOU READ IN THE RIGHT FILE -- CHECK TIMESTAMP
act_ben <- read_csv("211108_0113_act_ben.csv")
u_ben <- read_csv("211108_0113_u_ben.csv")
# sum(act_ben$beneficiarios)
# sum(u_ben$beneficiarios)
# census reference datasets
cen_ref <- read_excel("census_data_20191122.xlsx", sheet = "data") %>%
clean_names() %>%
select(estado, pcode1, municipio, pcode2, parroquia, pcode3, field_office,
poblacion_total_2011, x_2019_poblacion_parroquial_total,
ham_2019_ambitos_ge, ham_2019_xx_pobreza_env_por_parroquia,
ham_2019_xx_poblacion_pobre_por_parroquia,
poblacion_infantil_menor_de_12_anos, poblacion_adolescentes_de_12_a_17_anos,
poblacion_de_18_anos_y_mas,
poblacion_urbana_percent, area_km2, densidad_poblacional_ppl_km2,
matricula_2017_educacion_inicial, matricula_2017_educacion_primaria,
matricula_2017_educacion_media)
# filtering out PROMOCION MENSAJES CLAVES PARA LA COMUNIDAD ESCOLAR
CA105 <- act_ben %>% filter(actividad_codigo == "CA1.05")
# creating datasets without CA1.05 and
# for act_ben, recoding UNICEF and mutating short activity descriptions
act_ben2 <- act_ben %>%
filter(!str_detect(.$ubicacion, "^RADIO")) %>%
mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
mutate(actividad_short = recode(actividad_codigo,
CA1.01 = "1.01_reinsercion educativa",
CA1.02 = "1.02_nivelacion y capacitacion",
CA1.03 = "1.03_kits escolares",
CA1.04 = "1.04_alimentacion escolar",
CA1.05 = "1.05_promocion mensajes claves",
CA1.06 = "1.06_apoyo psicoeducativo",
CA1.07 = "1.07_actividades recreativas",
CA2.08 = "2.08_educacion a distancia",
CA2.09 = "2.09_formacion docentes",
CA2.10 = "2.10_becas docentes"))
u_ben2 <- u_ben %>% filter(!str_detect(.$ubicacion, "^RADIO"))
azure
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
fig.width = 10)
library(tidyverse)
library(lubridate)
library(stringr)
library(pander)
library(scales)
library(forcats)
library(janitor)
library(readxl)
library(ggmap)
library(sf)
library(patchwork)
library(maptools)
library(ggforce)
library(ggthemes)
library(plotly)
library(kableExtra)
library(DT)
library(tinytex)
library(webshot)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
fig.width = 10)
library(tidyverse)
library(lubridate)
library(stringr)
library(pander)
library(scales)
library(forcats)
library(janitor)
library(readxl)
library(ggmap)
library(sf)
library(patchwork)
library(maptools)
library(ggforce)
library(ggthemes)
library(plotly)
library(kableExtra)
library(DT)
library(tinytex)
# specifying column types
act_col_types <- c("date", "date", "text", "text","text","text",
"text","text","text","text","text","text","text",
"numeric", "numeric", "text","text","text",
"text","text","text", "numeric", "text",
"date", "date", "text", "numeric", "numeric",
"logical", "numeric", "numeric", "numeric",
"numeric", "numeric", "numeric", "numeric",
"numeric", "numeric", "numeric", "numeric",
"numeric", "numeric", "numeric")
# you're gonna have to live with the error messages,
# since you can't slice before read_excel() argument
act1<- read_excel("database activities 5W.xlsx",
sheet = "data",
skip = 1,
col_types = act_col_types) %>%
clean_names() %>%
remove_empty() %>%
slice(-c(1)) %>% # removes the second row
slice(-c(12055)) # removes the grand total
act_names <- c("fecha_reportado_cluster",
"mes_reportado",
"codigo_de_proyecto",
"nombre_del_proyecto",
"organizacion_lider",
"organizacion_implementadora",
"estado",
"pcode1",
"municipio",
"pcode2",
"parroquia",
"pcode3",
"ubicacion",
"latitud",
"longitud",
"actividad_full",
"actividad_codigo",
"actividad_desc",
"actividad_codigo_desc",
"act_covid",
"unidad",
"cantidad_del_mes",
"recurrente_beneficiarios",
"fecha_de_inicio",
"fecha_prevista_finalizacion",
"estatus_actividad",
"total_beneficiarios",
"check_beneficiaries",
"t_f_ben",
"percent_poblacion_indigena",
"percent_personas_con_discapacidad",
"m_0_3",
"m_3_6",
"m_7_12",
"m_12_17",
"m_18_19",
"f_0_3",
"f_3_6",
"f_7_12",
"f_12_17",
"f_18_19",
"f_mayores_de_19",
"m_mayores_de_19")
# renamed
names(act1) <- act_names
# function to remove accents
rm_accent <- function(colns){
colns <- stri_trans_general(colns, "Latin-ASCII")
}
# removing accents
act1 <- act1 %>%
mutate(estado    = rm_accent(str_to_upper(estado)), # string to upper and rm_accent
municipio = rm_accent(str_to_upper(municipio)),
parroquia = rm_accent(str_to_upper(parroquia)),
ubicacion = rm_accent(str_to_upper(ubicacion)),
actividad_desc = rm_accent(str_to_upper(actividad_desc)))
glimpse(act1)
act1 %>%
mutate(estado    = rm_accent(str_to_upper(estado)), # string to upper and rm_accent
municipio = rm_accent(str_to_upper(municipio)),
parroquia = rm_accent(str_to_upper(parroquia)),
ubicacion = rm_accent(str_to_upper(ubicacion)),
actividad_desc = rm_accent(str_to_upper(actividad_desc)))
library(stringi)
# removing accents
act1 <- act1 %>%
mutate(estado    = rm_accent(str_to_upper(estado)), # string to upper and rm_accent
municipio = rm_accent(str_to_upper(municipio)),
parroquia = rm_accent(str_to_upper(parroquia)),
ubicacion = rm_accent(str_to_upper(ubicacion)),
actividad_desc = rm_accent(str_to_upper(actividad_desc)))
act1 %>%
mutate(recurrente_beneficiarios =
recode(recurrente_beneficiarios,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "Sí" = TRUE),
act_covid = recode(act_covid,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "Sí" = TRUE)) %>%
replace_na(list(recurrente_beneficiarios = FALSE, act_covid = FALSE))
act2 <- act1 %>%
mutate(recurrente_beneficiarios =
recode(recurrente_beneficiarios,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "Sí" = TRUE),
act_covid = recode(act_covid,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "Sí" = TRUE)) %>%
replace_na(list(recurrente_beneficiarios = FALSE, act_covid = FALSE))
count(act2, recurrente_beneficiarios)
count(act1, recurrente_beneficiarios)
# yes
8+1+6408
# no
6+4937+694
count(act2, recurrente_beneficiarios)
# yes
8+1+6408
# no
6+4937+694
count(act2, recurrente_beneficiarios)
act2 <- act1 %>%
mutate(recurrente_beneficiarios =
recode(recurrente_beneficiarios,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "Sí" = TRUE),
act_covid = recode(act_covid,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "Sí" = TRUE))
count(act1, recurrente_beneficiarios)
act2 <- act1 %>%
mutate(recurrente_beneficiarios =
recode(recurrente_beneficiarios,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "sí" = TRUE, "Sí" = TRUE),
act_covid = recode(act_covid,
"no" = FALSE, "No" = FALSE, "Si" = TRUE, "si" = TRUE, "sí" = TRUE, "Sí" = TRUE)) %>%
replace_na(list(recurrente_beneficiarios = FALSE, act_covid = FALSE))
count(act2, recurrente_beneficiarios)
count(act1, act_covid)
# yes
1705+584
7097+2668
count(act2, act_covid)
glimpse(act1)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
fig.width = 10)
library(tidyverse)
library(lubridate)
library(stringr)
library(pander)
library(scales)
library(forcats)
library(janitor)
library(readxl)
library(ggmap)
library(sf)
library(patchwork)
library(maptools)
library(ggforce)
library(ggthemes)
library(plotly)
library(kableExtra)
library(DT)
library(tinytex)
library(webshot)
# pander thousands separator
panderOptions("big.mark", ",")
# MAKE SURE YOU READ IN THE RIGHT FILE -- CHECK TIMESTAMP
act_ben <- read_csv("211108_0113_act_ben.csv")
u_ben <- read_csv("211108_0113_u_ben.csv")
# sum(act_ben$beneficiarios)
# sum(u_ben$beneficiarios)
# census reference datasets
cen_ref <- read_excel("census_data_20191122.xlsx", sheet = "data") %>%
clean_names() %>%
select(estado, pcode1, municipio, pcode2, parroquia, pcode3, field_office,
poblacion_total_2011, x_2019_poblacion_parroquial_total,
ham_2019_ambitos_ge, ham_2019_xx_pobreza_env_por_parroquia,
ham_2019_xx_poblacion_pobre_por_parroquia,
poblacion_infantil_menor_de_12_anos, poblacion_adolescentes_de_12_a_17_anos,
poblacion_de_18_anos_y_mas,
poblacion_urbana_percent, area_km2, densidad_poblacional_ppl_km2,
matricula_2017_educacion_inicial, matricula_2017_educacion_primaria,
matricula_2017_educacion_media)
# filtering out PROMOCION MENSAJES CLAVES PARA LA COMUNIDAD ESCOLAR
CA105 <- act_ben %>% filter(actividad_codigo == "CA1.05")
# creating datasets without CA1.05 and
# for act_ben, recoding UNICEF and mutating short activity descriptions
act_ben2 <- act_ben %>%
filter(!str_detect(.$ubicacion, "^RADIO")) %>%
mutate(organizacion_implementadora =
str_replace_all(organizacion_implementadora,
"UNICEF - Fondo de las Naciones Unidas para la Infancia",
"UNICEF")) %>%
mutate(actividad_short = recode(actividad_codigo,
CA1.01 = "1.01_reinsercion educativa",
CA1.02 = "1.02_nivelacion y capacitacion",
CA1.03 = "1.03_kits escolares",
CA1.04 = "1.04_alimentacion escolar",
CA1.05 = "1.05_promocion mensajes claves",
CA1.06 = "1.06_apoyo psicoeducativo",
CA1.07 = "1.07_actividades recreativas",
CA2.08 = "2.08_educacion a distancia",
CA2.09 = "2.09_formacion docentes",
CA2.10 = "2.10_becas docentes"))
u_ben2 <- u_ben %>% filter(!str_detect(.$ubicacion, "^RADIO"))
